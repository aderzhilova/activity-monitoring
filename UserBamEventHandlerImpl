@Internal
public class UserBamEventHandlerImpl implements UserBamEventHandler {

	private UserAdHocActivityService UserAdHocActivityService;
	private PaymentDao paymentDao;

	public void handleEvent(PaymentUpdatedEvent event) {
		// No decline BAM event handling moved to handleEvent(PaymentDeclinedEvent event)
	}
	
	public void handleEvent(PaymentDeclinedEvent event) {
	    UserTransaction transaction = event.getTransaction();
        
	    if (transaction.getAmount().signum() < 0) {
	        return;
	    }
	    
	    Payment payment = paymentDao.findPaymentByNumber(event.getPaymentNumber()); 
	    UserAdHocActivityService.registerActivity(transaction.getAccount(), transaction.getAmount(), 
	            User_ACCOUNT_PAYMENT_STATUS_CHANGE, null, null, payment.getStatus().toString(), null, null, null);
	}

	public void handleEvent(PaymentCreatedEvent event) {
		// BAM record not needed ? 
	}

	public void handleEvent(AutomaticPaymentCreatedEvent event) {
		UserAdHocActivityService.registerActivity(event.getAccount(), event.getAmount(), User_PAYMENT_RECURRING, null, null, null, null, null, null);
	}

	public void handleEvent(AutomaticRefundCreatedEvent event) {
		UserAdHocActivityService.registerActivity(event.getAccount(), 
				event.getAmount(), 
				CREATED_AUTOMATED_REFUND, 
				null, 
				null, 
				event.getStatus().getName(),
				null, null, null);
	}

	public void handleEvent(HoldConfirmationBamEvent event) {
		UserAdHocActivityService.registerActivity(event.getUserAccount(), Hold_CONFIRMATION, event.getPolicyNumber(), event.getDueDate());
	}
}
